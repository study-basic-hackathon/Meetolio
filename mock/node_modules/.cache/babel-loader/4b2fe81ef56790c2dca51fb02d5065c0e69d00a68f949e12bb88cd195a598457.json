{"ast":null,"code":"import { Konva } from './Global.js';\nimport { Util } from './Util.js';\nexport const DD = {\n  get isDragging() {\n    var flag = false;\n    DD._dragElements.forEach(elem => {\n      if (elem.dragStatus === 'dragging') {\n        flag = true;\n      }\n    });\n    return flag;\n  },\n  justDragged: false,\n  get node() {\n    var node;\n    DD._dragElements.forEach(elem => {\n      node = elem.node;\n    });\n    return node;\n  },\n  _dragElements: new Map(),\n  _drag(evt) {\n    const nodesToFireEvents = [];\n    DD._dragElements.forEach((elem, key) => {\n      const {\n        node\n      } = elem;\n      const stage = node.getStage();\n      stage.setPointersPositions(evt);\n      if (elem.pointerId === undefined) {\n        elem.pointerId = Util._getFirstPointerId(evt);\n      }\n      const pos = stage._changedPointerPositions.find(pos => pos.id === elem.pointerId);\n      if (!pos) {\n        return;\n      }\n      if (elem.dragStatus !== 'dragging') {\n        var dragDistance = node.dragDistance();\n        var distance = Math.max(Math.abs(pos.x - elem.startPointerPos.x), Math.abs(pos.y - elem.startPointerPos.y));\n        if (distance < dragDistance) {\n          return;\n        }\n        node.startDrag({\n          evt\n        });\n        if (!node.isDragging()) {\n          return;\n        }\n      }\n      node._setDragPosition(evt, elem);\n      nodesToFireEvents.push(node);\n    });\n    nodesToFireEvents.forEach(node => {\n      node.fire('dragmove', {\n        type: 'dragmove',\n        target: node,\n        evt: evt\n      }, true);\n    });\n  },\n  _endDragBefore(evt) {\n    const drawNodes = [];\n    DD._dragElements.forEach(elem => {\n      const {\n        node\n      } = elem;\n      const stage = node.getStage();\n      if (evt) {\n        stage.setPointersPositions(evt);\n      }\n      const pos = stage._changedPointerPositions.find(pos => pos.id === elem.pointerId);\n      if (!pos) {\n        return;\n      }\n      if (elem.dragStatus === 'dragging' || elem.dragStatus === 'stopped') {\n        DD.justDragged = true;\n        Konva._mouseListenClick = false;\n        Konva._touchListenClick = false;\n        Konva._pointerListenClick = false;\n        elem.dragStatus = 'stopped';\n      }\n      const drawNode = elem.node.getLayer() || elem.node instanceof Konva['Stage'] && elem.node;\n      if (drawNode && drawNodes.indexOf(drawNode) === -1) {\n        drawNodes.push(drawNode);\n      }\n    });\n    drawNodes.forEach(drawNode => {\n      drawNode.draw();\n    });\n  },\n  _endDragAfter(evt) {\n    DD._dragElements.forEach((elem, key) => {\n      if (elem.dragStatus === 'stopped') {\n        elem.node.fire('dragend', {\n          type: 'dragend',\n          target: elem.node,\n          evt: evt\n        }, true);\n      }\n      if (elem.dragStatus !== 'dragging') {\n        DD._dragElements.delete(key);\n      }\n    });\n  }\n};\nif (Konva.isBrowser) {\n  window.addEventListener('mouseup', DD._endDragBefore, true);\n  window.addEventListener('touchend', DD._endDragBefore, true);\n  window.addEventListener('mousemove', DD._drag);\n  window.addEventListener('touchmove', DD._drag);\n  window.addEventListener('mouseup', DD._endDragAfter, false);\n  window.addEventListener('touchend', DD._endDragAfter, false);\n}","map":{"version":3,"names":["Konva","Util","DD","isDragging","flag","_dragElements","forEach","elem","dragStatus","justDragged","node","Map","_drag","evt","nodesToFireEvents","key","stage","getStage","setPointersPositions","pointerId","undefined","_getFirstPointerId","pos","_changedPointerPositions","find","id","dragDistance","distance","Math","max","abs","x","startPointerPos","y","startDrag","_setDragPosition","push","fire","type","target","_endDragBefore","drawNodes","_mouseListenClick","_touchListenClick","_pointerListenClick","drawNode","getLayer","indexOf","draw","_endDragAfter","delete","isBrowser","window","addEventListener"],"sources":["/Users/takahiro/Dev/webhack/node_modules/konva/lib/DragAndDrop.js"],"sourcesContent":["import { Konva } from './Global.js';\nimport { Util } from './Util.js';\nexport const DD = {\n    get isDragging() {\n        var flag = false;\n        DD._dragElements.forEach((elem) => {\n            if (elem.dragStatus === 'dragging') {\n                flag = true;\n            }\n        });\n        return flag;\n    },\n    justDragged: false,\n    get node() {\n        var node;\n        DD._dragElements.forEach((elem) => {\n            node = elem.node;\n        });\n        return node;\n    },\n    _dragElements: new Map(),\n    _drag(evt) {\n        const nodesToFireEvents = [];\n        DD._dragElements.forEach((elem, key) => {\n            const { node } = elem;\n            const stage = node.getStage();\n            stage.setPointersPositions(evt);\n            if (elem.pointerId === undefined) {\n                elem.pointerId = Util._getFirstPointerId(evt);\n            }\n            const pos = stage._changedPointerPositions.find((pos) => pos.id === elem.pointerId);\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus !== 'dragging') {\n                var dragDistance = node.dragDistance();\n                var distance = Math.max(Math.abs(pos.x - elem.startPointerPos.x), Math.abs(pos.y - elem.startPointerPos.y));\n                if (distance < dragDistance) {\n                    return;\n                }\n                node.startDrag({ evt });\n                if (!node.isDragging()) {\n                    return;\n                }\n            }\n            node._setDragPosition(evt, elem);\n            nodesToFireEvents.push(node);\n        });\n        nodesToFireEvents.forEach((node) => {\n            node.fire('dragmove', {\n                type: 'dragmove',\n                target: node,\n                evt: evt,\n            }, true);\n        });\n    },\n    _endDragBefore(evt) {\n        const drawNodes = [];\n        DD._dragElements.forEach((elem) => {\n            const { node } = elem;\n            const stage = node.getStage();\n            if (evt) {\n                stage.setPointersPositions(evt);\n            }\n            const pos = stage._changedPointerPositions.find((pos) => pos.id === elem.pointerId);\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus === 'dragging' || elem.dragStatus === 'stopped') {\n                DD.justDragged = true;\n                Konva._mouseListenClick = false;\n                Konva._touchListenClick = false;\n                Konva._pointerListenClick = false;\n                elem.dragStatus = 'stopped';\n            }\n            const drawNode = elem.node.getLayer() ||\n                (elem.node instanceof Konva['Stage'] && elem.node);\n            if (drawNode && drawNodes.indexOf(drawNode) === -1) {\n                drawNodes.push(drawNode);\n            }\n        });\n        drawNodes.forEach((drawNode) => {\n            drawNode.draw();\n        });\n    },\n    _endDragAfter(evt) {\n        DD._dragElements.forEach((elem, key) => {\n            if (elem.dragStatus === 'stopped') {\n                elem.node.fire('dragend', {\n                    type: 'dragend',\n                    target: elem.node,\n                    evt: evt,\n                }, true);\n            }\n            if (elem.dragStatus !== 'dragging') {\n                DD._dragElements.delete(key);\n            }\n        });\n    },\n};\nif (Konva.isBrowser) {\n    window.addEventListener('mouseup', DD._endDragBefore, true);\n    window.addEventListener('touchend', DD._endDragBefore, true);\n    window.addEventListener('mousemove', DD._drag);\n    window.addEventListener('touchmove', DD._drag);\n    window.addEventListener('mouseup', DD._endDragAfter, false);\n    window.addEventListener('touchend', DD._endDragAfter, false);\n}\n"],"mappings":"AAAA,SAASA,KAAK,QAAQ,aAAa;AACnC,SAASC,IAAI,QAAQ,WAAW;AAChC,OAAO,MAAMC,EAAE,GAAG;EACd,IAAIC,UAAUA,CAAA,EAAG;IACb,IAAIC,IAAI,GAAG,KAAK;IAChBF,EAAE,CAACG,aAAa,CAACC,OAAO,CAAEC,IAAI,IAAK;MAC/B,IAAIA,IAAI,CAACC,UAAU,KAAK,UAAU,EAAE;QAChCJ,IAAI,GAAG,IAAI;MACf;IACJ,CAAC,CAAC;IACF,OAAOA,IAAI;EACf,CAAC;EACDK,WAAW,EAAE,KAAK;EAClB,IAAIC,IAAIA,CAAA,EAAG;IACP,IAAIA,IAAI;IACRR,EAAE,CAACG,aAAa,CAACC,OAAO,CAAEC,IAAI,IAAK;MAC/BG,IAAI,GAAGH,IAAI,CAACG,IAAI;IACpB,CAAC,CAAC;IACF,OAAOA,IAAI;EACf,CAAC;EACDL,aAAa,EAAE,IAAIM,GAAG,CAAC,CAAC;EACxBC,KAAKA,CAACC,GAAG,EAAE;IACP,MAAMC,iBAAiB,GAAG,EAAE;IAC5BZ,EAAE,CAACG,aAAa,CAACC,OAAO,CAAC,CAACC,IAAI,EAAEQ,GAAG,KAAK;MACpC,MAAM;QAAEL;MAAK,CAAC,GAAGH,IAAI;MACrB,MAAMS,KAAK,GAAGN,IAAI,CAACO,QAAQ,CAAC,CAAC;MAC7BD,KAAK,CAACE,oBAAoB,CAACL,GAAG,CAAC;MAC/B,IAAIN,IAAI,CAACY,SAAS,KAAKC,SAAS,EAAE;QAC9Bb,IAAI,CAACY,SAAS,GAAGlB,IAAI,CAACoB,kBAAkB,CAACR,GAAG,CAAC;MACjD;MACA,MAAMS,GAAG,GAAGN,KAAK,CAACO,wBAAwB,CAACC,IAAI,CAAEF,GAAG,IAAKA,GAAG,CAACG,EAAE,KAAKlB,IAAI,CAACY,SAAS,CAAC;MACnF,IAAI,CAACG,GAAG,EAAE;QACN;MACJ;MACA,IAAIf,IAAI,CAACC,UAAU,KAAK,UAAU,EAAE;QAChC,IAAIkB,YAAY,GAAGhB,IAAI,CAACgB,YAAY,CAAC,CAAC;QACtC,IAAIC,QAAQ,GAAGC,IAAI,CAACC,GAAG,CAACD,IAAI,CAACE,GAAG,CAACR,GAAG,CAACS,CAAC,GAAGxB,IAAI,CAACyB,eAAe,CAACD,CAAC,CAAC,EAAEH,IAAI,CAACE,GAAG,CAACR,GAAG,CAACW,CAAC,GAAG1B,IAAI,CAACyB,eAAe,CAACC,CAAC,CAAC,CAAC;QAC3G,IAAIN,QAAQ,GAAGD,YAAY,EAAE;UACzB;QACJ;QACAhB,IAAI,CAACwB,SAAS,CAAC;UAAErB;QAAI,CAAC,CAAC;QACvB,IAAI,CAACH,IAAI,CAACP,UAAU,CAAC,CAAC,EAAE;UACpB;QACJ;MACJ;MACAO,IAAI,CAACyB,gBAAgB,CAACtB,GAAG,EAAEN,IAAI,CAAC;MAChCO,iBAAiB,CAACsB,IAAI,CAAC1B,IAAI,CAAC;IAChC,CAAC,CAAC;IACFI,iBAAiB,CAACR,OAAO,CAAEI,IAAI,IAAK;MAChCA,IAAI,CAAC2B,IAAI,CAAC,UAAU,EAAE;QAClBC,IAAI,EAAE,UAAU;QAChBC,MAAM,EAAE7B,IAAI;QACZG,GAAG,EAAEA;MACT,CAAC,EAAE,IAAI,CAAC;IACZ,CAAC,CAAC;EACN,CAAC;EACD2B,cAAcA,CAAC3B,GAAG,EAAE;IAChB,MAAM4B,SAAS,GAAG,EAAE;IACpBvC,EAAE,CAACG,aAAa,CAACC,OAAO,CAAEC,IAAI,IAAK;MAC/B,MAAM;QAAEG;MAAK,CAAC,GAAGH,IAAI;MACrB,MAAMS,KAAK,GAAGN,IAAI,CAACO,QAAQ,CAAC,CAAC;MAC7B,IAAIJ,GAAG,EAAE;QACLG,KAAK,CAACE,oBAAoB,CAACL,GAAG,CAAC;MACnC;MACA,MAAMS,GAAG,GAAGN,KAAK,CAACO,wBAAwB,CAACC,IAAI,CAAEF,GAAG,IAAKA,GAAG,CAACG,EAAE,KAAKlB,IAAI,CAACY,SAAS,CAAC;MACnF,IAAI,CAACG,GAAG,EAAE;QACN;MACJ;MACA,IAAIf,IAAI,CAACC,UAAU,KAAK,UAAU,IAAID,IAAI,CAACC,UAAU,KAAK,SAAS,EAAE;QACjEN,EAAE,CAACO,WAAW,GAAG,IAAI;QACrBT,KAAK,CAAC0C,iBAAiB,GAAG,KAAK;QAC/B1C,KAAK,CAAC2C,iBAAiB,GAAG,KAAK;QAC/B3C,KAAK,CAAC4C,mBAAmB,GAAG,KAAK;QACjCrC,IAAI,CAACC,UAAU,GAAG,SAAS;MAC/B;MACA,MAAMqC,QAAQ,GAAGtC,IAAI,CAACG,IAAI,CAACoC,QAAQ,CAAC,CAAC,IAChCvC,IAAI,CAACG,IAAI,YAAYV,KAAK,CAAC,OAAO,CAAC,IAAIO,IAAI,CAACG,IAAK;MACtD,IAAImC,QAAQ,IAAIJ,SAAS,CAACM,OAAO,CAACF,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE;QAChDJ,SAAS,CAACL,IAAI,CAACS,QAAQ,CAAC;MAC5B;IACJ,CAAC,CAAC;IACFJ,SAAS,CAACnC,OAAO,CAAEuC,QAAQ,IAAK;MAC5BA,QAAQ,CAACG,IAAI,CAAC,CAAC;IACnB,CAAC,CAAC;EACN,CAAC;EACDC,aAAaA,CAACpC,GAAG,EAAE;IACfX,EAAE,CAACG,aAAa,CAACC,OAAO,CAAC,CAACC,IAAI,EAAEQ,GAAG,KAAK;MACpC,IAAIR,IAAI,CAACC,UAAU,KAAK,SAAS,EAAE;QAC/BD,IAAI,CAACG,IAAI,CAAC2B,IAAI,CAAC,SAAS,EAAE;UACtBC,IAAI,EAAE,SAAS;UACfC,MAAM,EAAEhC,IAAI,CAACG,IAAI;UACjBG,GAAG,EAAEA;QACT,CAAC,EAAE,IAAI,CAAC;MACZ;MACA,IAAIN,IAAI,CAACC,UAAU,KAAK,UAAU,EAAE;QAChCN,EAAE,CAACG,aAAa,CAAC6C,MAAM,CAACnC,GAAG,CAAC;MAChC;IACJ,CAAC,CAAC;EACN;AACJ,CAAC;AACD,IAAIf,KAAK,CAACmD,SAAS,EAAE;EACjBC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEnD,EAAE,CAACsC,cAAc,EAAE,IAAI,CAAC;EAC3DY,MAAM,CAACC,gBAAgB,CAAC,UAAU,EAAEnD,EAAE,CAACsC,cAAc,EAAE,IAAI,CAAC;EAC5DY,MAAM,CAACC,gBAAgB,CAAC,WAAW,EAAEnD,EAAE,CAACU,KAAK,CAAC;EAC9CwC,MAAM,CAACC,gBAAgB,CAAC,WAAW,EAAEnD,EAAE,CAACU,KAAK,CAAC;EAC9CwC,MAAM,CAACC,gBAAgB,CAAC,SAAS,EAAEnD,EAAE,CAAC+C,aAAa,EAAE,KAAK,CAAC;EAC3DG,MAAM,CAACC,gBAAgB,CAAC,UAAU,EAAEnD,EAAE,CAAC+C,aAAa,EAAE,KAAK,CAAC;AAChE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}