{"ast":null,"code":"import _objectSpread from\"/Users/takahiro/Dev/webhack/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from\"react\";import{useNavigate}from\"react-router-dom\";import{useAuth}from\"../contexts/AuthContext\";import{Stage,Layer,Rect,Text,Transformer,Circle,Line,Group}from\"react-konva\";import\"./BusinessCardDesign.css\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const BusinessCardDesign=()=>{const{user,isAuthenticated}=useAuth();const navigate=useNavigate();const[profile,setProfile]=useState(null);const[isLoading,setIsLoading]=useState(true);const[currentSide,setCurrentSide]=useState(\"front\");const[elements,setElements]=useState([]);const[selectedId,setSelectedId]=useState(null);const[editingText,setEditingText]=useState(\"\");const[fontSize,setFontSize]=useState(16);const[textColor,setTextColor]=useState(\"#000000\");const[fontFamily,setFontFamily]=useState(\"Arial\");const[currentTool,setCurrentTool]=useState(\"select\");const[showGrid,setShowGrid]=useState(false);const[showGuidelines,setShowGuidelines]=useState(true);const[history,setHistory]=useState([]);const[historyIndex,setHistoryIndex]=useState(-1);const[showTextModal,setShowTextModal]=useState(false);const[selectedTextStyle,setSelectedTextStyle]=useState(\"body\");const[contextMenu,setContextMenu]=useState({visible:false,x:0,y:0,elementId:\"\"});const transformerRef=useRef(null);const stageRef=useRef(null);useEffect(()=>{if(!isAuthenticated){navigate(\"/login\");return;}// モックプロフィールデータを取得\nconst mockProfile={id:\"1\",userId:(user===null||user===void 0?void 0:user.id)||\"1\",company:\"テック株式会社\",jobTitle:\"フロントエンドエンジニア\",bio:\"Web開発に携わって5年目です。React、TypeScript、Node.jsを中心に開発を行っています。ユーザビリティを重視した設計を心がけています。\",skills:[\"React\",\"TypeScript\",\"Node.js\",\"CSS\",\"HTML\",\"JavaScript\",\"Git\",\"AWS\"],interests:[\"プログラミング\",\"読書\",\"旅行\",\"料理\",\"音楽\"],contactInfo:{email:\"taro.tech@example.com\",phone:\"090-1234-5678\",sns:{twitter:\"taro_tech\",linkedin:\"taro-tech\",github:\"taro-tech\",instagram:\"taro_tech_dev\"},website:\"https://taro-tech.dev\"},isPublic:true,createdAt:new Date(\"2024-01-01\"),updatedAt:new Date()};setProfile(mockProfile);setIsLoading(false);},[isAuthenticated,user,navigate]);// 初期テキスト要素を設定\nuseEffect(()=>{if(profile){const initialElements=currentSide===\"front\"?[{id:\"company\",type:\"text\",text:profile.company||\"会社名\",x:200,y:60,fontSize:18,fontFamily:\"Arial\",fill:\"#000000\",width:400,align:\"center\",draggable:true,textStyle:\"heading\"},{id:\"jobTitle\",type:\"text\",text:profile.jobTitle||\"役職\",x:200,y:90,fontSize:14,fontFamily:\"Arial\",fill:\"#666666\",width:400,align:\"center\",draggable:true,textStyle:\"subheading\"},{id:\"name\",type:\"text\",text:(user===null||user===void 0?void 0:user.name)||\"氏名\",x:200,y:120,fontSize:16,fontFamily:\"Arial\",fill:\"#000000\",width:400,align:\"center\",draggable:true,textStyle:\"body\"}]:[{id:\"email\",type:\"text\",text:profile.contactInfo.email||\"メールアドレス\",x:200,y:80,fontSize:12,fontFamily:\"Arial\",fill:\"#000000\",width:400,align:\"center\",draggable:true,textStyle:\"body\"},{id:\"phone\",type:\"text\",text:profile.contactInfo.phone||\"電話番号\",x:200,y:110,fontSize:12,fontFamily:\"Arial\",fill:\"#000000\",width:400,align:\"center\",draggable:true,textStyle:\"body\"},{id:\"website\",type:\"text\",text:profile.contactInfo.website||\"ウェブサイト\",x:200,y:140,fontSize:12,fontFamily:\"Arial\",fill:\"#000000\",width:400,align:\"center\",draggable:true,textStyle:\"body\"}];setElements(initialElements);// eslint-disable-next-line react-hooks/exhaustive-deps\naddToHistory(initialElements);}},[profile,currentSide,user]);// 選択された要素のTransformerを更新\nuseEffect(()=>{if(selectedId&&transformerRef.current){var _stageRef$current;const node=(_stageRef$current=stageRef.current)===null||_stageRef$current===void 0?void 0:_stageRef$current.findOne(\"#\".concat(selectedId));if(node){var _transformerRef$curre;transformerRef.current.nodes([node]);(_transformerRef$curre=transformerRef.current.getLayer())===null||_transformerRef$curre===void 0?void 0:_transformerRef$curre.batchDraw();}}},[selectedId]);// 履歴管理\nconst addToHistory=newElements=>{const newHistory=history.slice(0,historyIndex+1);newHistory.push([...newElements]);setHistory(newHistory);setHistoryIndex(newHistory.length-1);};const undo=()=>{if(historyIndex>0){const newIndex=historyIndex-1;setHistoryIndex(newIndex);setElements([...history[newIndex]]);}};const redo=()=>{if(historyIndex<history.length-1){const newIndex=historyIndex+1;setHistoryIndex(newIndex);setElements([...history[newIndex]]);}};const moveElement=(id,direction)=>{const newElements=[...elements];const currentIndex=newElements.findIndex(el=>el.id===id);if(direction===\"forward\"&&currentIndex<newElements.length-1){[newElements[currentIndex],newElements[currentIndex+1]]=[newElements[currentIndex+1],newElements[currentIndex]];}else if(direction===\"backward\"&&currentIndex>0){[newElements[currentIndex],newElements[currentIndex-1]]=[newElements[currentIndex-1],newElements[currentIndex]];}setElements(newElements);addToHistory(newElements);};const alignElements=alignment=>{if(selectedId){const selectedElement=elements.find(el=>el.id===selectedId);if(!selectedElement)return;const newElements=elements.map(el=>{if(el.id===selectedId){const newEl=_objectSpread({},el);switch(alignment){case\"left\":newEl.x=50;break;case\"center\":newEl.x=200;break;case\"right\":newEl.x=350;break;case\"top\":newEl.y=50;break;case\"middle\":newEl.y=121;break;case\"bottom\":newEl.y=192;break;}return newEl;}return el;});setElements(newElements);addToHistory(newElements);}};const handleTextClick=(id,event)=>{setSelectedId(id);// コンテキストメニューの位置を計算\nconst stage=event.target.getStage();const pointerPosition=stage.getPointerPosition();// Konvaステージの左上にコンテキストメニューを配置\n// canvas-wrapperの位置を考慮して座標を計算\nconst canvasWrapper=document.querySelector(\".canvas-wrapper\");if(canvasWrapper){const rect=canvasWrapper.getBoundingClientRect();setContextMenu({visible:true,x:rect.left+10,// canvas-wrapperの左上から10px右\ny:rect.top+10,// canvas-wrapperの左上から10px下\nelementId:id});}else{// フォールバック: 固定位置\nsetContextMenu({visible:true,x:10,y:10,elementId:id});}};const handleTextEdit=(id,newText)=>{const newElements=elements.map(el=>el.id===id&&el.type===\"text\"?_objectSpread(_objectSpread({},el),{},{text:newText}):el);setElements(newElements);addToHistory(newElements);setEditingText(\"\");};const handleElementUpdate=(id,updates)=>{const newElements=elements.map(el=>el.id===id?_objectSpread(_objectSpread({},el),updates):el);setElements(newElements);addToHistory(newElements);};const handleAddText=function(){let style=arguments.length>0&&arguments[0]!==undefined?arguments[0]:\"body\";let fontSize=16;let y=100;switch(style){case\"heading\":fontSize=24;y=80;break;case\"subheading\":fontSize=18;y=110;break;case\"body\":fontSize=14;y=140;break;}const newText={id:\"text-\".concat(Date.now()),type:\"text\",text:style===\"heading\"?\"見出し\":style===\"subheading\"?\"小見出し\":\"本文\",x:200,y:y,fontSize:fontSize,fontFamily:fontFamily,fill:textColor,width:400,align:\"center\",draggable:true,textStyle:style};const newElements=[...elements,newText];setElements(newElements);addToHistory(newElements);setSelectedId(newText.id);setShowTextModal(true);};const handleAddShape=shapeType=>{let newShape;switch(shapeType){case\"rect\":newShape={id:\"rect-\".concat(Date.now()),type:\"rect\",x:100,y:100,width:100,height:60,fill:textColor,stroke:\"#000000\",strokeWidth:2,draggable:true};break;case\"circle\":newShape={id:\"circle-\".concat(Date.now()),type:\"circle\",x:150,y:150,radius:30,fill:textColor,stroke:\"#000000\",strokeWidth:2,draggable:true};break;case\"line\":newShape={id:\"line-\".concat(Date.now()),type:\"line\",x:100,y:100,points:[0,0,100,0],fill:\"#000000\",stroke:\"#000000\",strokeWidth:2,draggable:true};break;}const newElements=[...elements,newShape];setElements(newElements);addToHistory(newElements);setSelectedId(newShape.id);};const handleAddIcon=iconType=>{const newIcon={id:\"icon-\".concat(Date.now()),type:\"icon\",iconType,x:100,y:100,size:24,fill:textColor,draggable:true};const newElements=[...elements,newIcon];setElements(newElements);addToHistory(newElements);setSelectedId(newIcon.id);};const handleDeleteElement=()=>{if(selectedId){const newElements=elements.filter(el=>el.id!==selectedId);setElements(newElements);addToHistory(newElements);setSelectedId(null);}};const handleSave=async()=>{try{await new Promise(resolve=>setTimeout(resolve,1000));console.log(\"名刺デザインを保存しました\");console.log(\"現在の要素:\",elements);navigate(\"/business-card/edit\");}catch(error){console.error(\"名刺デザインの保存に失敗しました:\",error);}};const handleCancel=()=>{navigate(\"/business-card/edit\");};const handleExportImage=()=>{if(stageRef.current){const dataURL=stageRef.current.toDataURL();const link=document.createElement(\"a\");link.download=\"business-card-\".concat(currentSide,\".png\");link.href=dataURL;link.click();}};const renderElement=element=>{switch(element.type){case\"text\":return/*#__PURE__*/_jsx(Text,{id:element.id,text:element.text,x:element.x,y:element.y,fontSize:element.fontSize,fontFamily:element.fontFamily,fill:element.fill,align:element.align,width:element.width,draggable:element.draggable,onClick:e=>handleTextClick(element.id,e),onTap:e=>handleTextClick(element.id,e),onDragEnd:e=>{handleElementUpdate(element.id,{x:e.target.x(),y:e.target.y()});}},element.id);case\"rect\":return/*#__PURE__*/_jsx(Rect,{id:element.id,x:element.x,y:element.y,width:element.width,height:element.height,fill:element.fill,stroke:element.stroke,strokeWidth:element.strokeWidth,draggable:element.draggable,onClick:()=>setSelectedId(element.id),onTap:()=>setSelectedId(element.id),onDragEnd:e=>{handleElementUpdate(element.id,{x:e.target.x(),y:e.target.y()});}},element.id);case\"circle\":return/*#__PURE__*/_jsx(Circle,{id:element.id,x:element.x,y:element.y,radius:element.radius,fill:element.fill,stroke:element.stroke,strokeWidth:element.strokeWidth,draggable:element.draggable,onClick:()=>setSelectedId(element.id),onTap:()=>setSelectedId(element.id),onDragEnd:e=>{handleElementUpdate(element.id,{x:e.target.x(),y:e.target.y()});}},element.id);case\"line\":return/*#__PURE__*/_jsx(Line,{id:element.id,x:element.x,y:element.y,points:element.points,fill:element.fill,stroke:element.stroke,strokeWidth:element.strokeWidth,draggable:element.draggable,onClick:()=>setSelectedId(element.id),onTap:()=>setSelectedId(element.id),onDragEnd:e=>{handleElementUpdate(element.id,{x:e.target.x(),y:e.target.y()});}},element.id);case\"icon\":return/*#__PURE__*/_jsxs(Group,{id:element.id,x:element.x,y:element.y,draggable:element.draggable,onClick:()=>setSelectedId(element.id),onTap:()=>setSelectedId(element.id),onDragEnd:e=>{handleElementUpdate(element.id,{x:e.target.x(),y:e.target.y()});},children:[element.iconType===\"phone\"&&/*#__PURE__*/_jsx(Rect,{x:0,y:0,width:element.size,height:element.size*1.6,fill:element.fill}),element.iconType===\"email\"&&/*#__PURE__*/_jsx(Rect,{x:0,y:0,width:element.size,height:element.size*0.8,fill:element.fill}),element.iconType===\"website\"&&/*#__PURE__*/_jsx(Circle,{x:element.size/2,y:element.size/2,radius:element.size/2,fill:element.fill})]},element.id);default:return null;}};if(isLoading){return/*#__PURE__*/_jsx(\"div\",{className:\"business-card-design\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:\"\\u8AAD\\u307F\\u8FBC\\u307F\\u4E2D...\"})})});}if(!profile){return/*#__PURE__*/_jsx(\"div\",{className:\"business-card-design\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"error\",children:\"\\u30D7\\u30ED\\u30D5\\u30A3\\u30FC\\u30EB\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u305B\\u3093\"})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"business-card-design\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"design-header\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"\\u540D\\u523A\\u30C7\\u30B6\\u30A4\\u30F3\"}),/*#__PURE__*/_jsx(\"p\",{children:\"\\u540D\\u523A\\u306E\\u8868\\u9762\\u30FB\\u88CF\\u9762\\u3092\\u30C7\\u30B6\\u30A4\\u30F3\\u3067\\u304D\\u307E\\u3059\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"design-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"side-tabs\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"side-tab \".concat(currentSide===\"front\"?\"active\":\"\"),onClick:()=>setCurrentSide(\"front\"),children:\"\\u8868\\u9762\"}),/*#__PURE__*/_jsx(\"button\",{className:\"side-tab \".concat(currentSide===\"back\"?\"active\":\"\"),onClick:()=>setCurrentSide(\"back\"),children:\"\\u88CF\\u9762\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"canvas-container\",children:/*#__PURE__*/_jsx(\"div\",{className:\"canvas-wrapper\",children:/*#__PURE__*/_jsx(Stage,{ref:stageRef,width:400,height:242,onMouseDown:e=>{if(e.target===e.target.getStage()){setSelectedId(null);setContextMenu(_objectSpread(_objectSpread({},contextMenu),{},{visible:false}));}},children:/*#__PURE__*/_jsxs(Layer,{children:[/*#__PURE__*/_jsx(Rect,{x:0,y:0,width:400,height:242,fill:\"#ffffff\",stroke:\"#e5e7eb\",strokeWidth:1}),showGrid&&/*#__PURE__*/_jsxs(_Fragment,{children:[Array.from({length:20},(_,i)=>/*#__PURE__*/_jsx(Line,{x:i*20,y:0,points:[0,0,0,242],stroke:\"#f0f0f0\",strokeWidth:1},\"grid-v-\".concat(i))),Array.from({length:13},(_,i)=>/*#__PURE__*/_jsx(Line,{x:0,y:i*20,points:[0,0,400,0],stroke:\"#f0f0f0\",strokeWidth:1},\"grid-h-\".concat(i)))]}),showGuidelines&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Line,{x:200,y:0,points:[0,0,0,242],stroke:\"#3b82f6\",strokeWidth:1,dash:[5,5]}),/*#__PURE__*/_jsx(Line,{x:0,y:121,points:[0,0,400,0],stroke:\"#3b82f6\",strokeWidth:1,dash:[5,5]})]}),elements.map(renderElement),selectedId&&/*#__PURE__*/_jsx(Transformer,{ref:transformerRef})]})})})}),/*#__PURE__*/_jsx(\"div\",{className:\"bottom-toolbar\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-scroll\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item\",onClick:()=>setCurrentTool(\"select\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"\\u270B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u9078\\u629E\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item\",onClick:()=>handleAddText(\"heading\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"T\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u30C6\\u30AD\\u30B9\\u30C8\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item\",onClick:()=>handleAddShape(\"rect\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"\\u25A1\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u56F3\\u5F62\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item\",onClick:()=>handleAddIcon(\"phone\"),children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"\\uD83D\\uDCDE\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u30A2\\u30A4\\u30B3\\u30F3\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item \".concat(historyIndex<=0?\"disabled\":\"\"),onClick:historyIndex>0?undo:undefined,children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"\\u21B6\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u623B\\u308B\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"toolbar-item \".concat(historyIndex>=history.length-1?\"disabled\":\"\"),onClick:historyIndex<history.length-1?redo:undefined,children:[/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-icon\",children:\"\\u21B7\"}),/*#__PURE__*/_jsx(\"div\",{className:\"toolbar-label\",children:\"\\u9032\\u3080\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"design-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:handleCancel,children:\"\\u30AD\\u30E3\\u30F3\\u30BB\\u30EB\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:handleSave,children:\"\\u30C7\\u30B6\\u30A4\\u30F3\\u3092\\u4FDD\\u5B58\"})]})]})]}),showTextModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowTextModal(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\u30C6\\u30AD\\u30B9\\u30C8\\u7DE8\\u96C6\"}),/*#__PURE__*/_jsx(\"button\",{className:\"modal-close\",onClick:()=>setShowTextModal(false),children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"search-section\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"search-bar\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"search-icon\",children:\"\\uD83D\\uDD0D\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"\\u30D5\\u30A9\\u30F3\\u30C8\\u3068\\u7D44\\u307F\\u5408\\u308F\\u305B\\u3092\\u691C\\u7D22\",className:\"search-input\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-options\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"text-option-btn primary\",onClick:()=>handleAddText(\"heading\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-icon\",children:\"T\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-label\",children:\"\\u898B\\u51FA\\u3057\\u3092\\u8FFD\\u52A0\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"text-option-btn secondary\",onClick:()=>handleAddText(\"subheading\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-icon\",children:\"T\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-label\",children:\"\\u5C0F\\u898B\\u51FA\\u3057\\u3092\\u8FFD\\u52A0\"})]}),/*#__PURE__*/_jsxs(\"button\",{className:\"text-option-btn secondary\",onClick:()=>handleAddText(\"body\"),children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-icon\",children:\"T\"}),/*#__PURE__*/_jsx(\"span\",{className:\"text-label\",children:\"\\u672C\\u6587\\u3092\\u8FFD\\u52A0\"})]})]}),selectedId&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-editor-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u30C6\\u30AD\\u30B9\\u30C8\\u7DE8\\u96C6\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:editingText,onChange:e=>setEditingText(e.target.value),onBlur:()=>handleTextEdit(selectedId,editingText),onKeyPress:e=>{if(e.key===\"Enter\"){handleTextEdit(selectedId,editingText);}},placeholder:\"\\u30C6\\u30AD\\u30B9\\u30C8\\u3092\\u5165\\u529B\",className:\"text-input\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"style-controls\",children:[/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u30D5\\u30A9\\u30F3\\u30C8\\u30B5\\u30A4\\u30BA:\",/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"8\",max:\"48\",value:fontSize,onChange:e=>{setFontSize(Number(e.target.value));if(selectedId){const element=elements.find(el=>el.id===selectedId);if(element&&element.type===\"text\"){handleElementUpdate(selectedId,{fontSize:Number(e.target.value)});}}},className:\"font-size-slider\"}),/*#__PURE__*/_jsxs(\"span\",{children:[fontSize,\"px\"]})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u30D5\\u30A9\\u30F3\\u30C8:\",/*#__PURE__*/_jsxs(\"select\",{value:fontFamily,onChange:e=>{setFontFamily(e.target.value);if(selectedId){const element=elements.find(el=>el.id===selectedId);if(element&&element.type===\"text\"){handleElementUpdate(selectedId,{fontFamily:e.target.value});}}},className:\"font-family-select\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"Arial\",children:\"Arial\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Helvetica\",children:\"Helvetica\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Times New Roman\",children:\"Times New Roman\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Georgia\",children:\"Georgia\"}),/*#__PURE__*/_jsx(\"option\",{value:\"Verdana\",children:\"Verdana\"})]})]}),/*#__PURE__*/_jsxs(\"label\",{children:[\"\\u8272:\",/*#__PURE__*/_jsx(\"input\",{type:\"color\",value:textColor,onChange:e=>{setTextColor(e.target.value);if(selectedId){handleElementUpdate(selectedId,{fill:e.target.value});}},className:\"color-picker\"})]})]})]})]})]})}),contextMenu.visible&&/*#__PURE__*/_jsxs(\"div\",{className:\"context-menu\",style:{position:\"absolute\",left:contextMenu.x,top:contextMenu.y,zIndex:1000},children:[/*#__PURE__*/_jsx(\"button\",{className:\"context-menu-btn edit-btn\",onClick:()=>{const element=elements.find(el=>el.id===contextMenu.elementId);if(element&&element.type===\"text\"){setEditingText(element.text);setSelectedTextStyle(element.textStyle||\"body\");setShowTextModal(true);}setContextMenu(_objectSpread(_objectSpread({},contextMenu),{},{visible:false}));},children:\"\\u270F\\uFE0F\"}),/*#__PURE__*/_jsx(\"button\",{className:\"context-menu-btn delete-btn\",onClick:()=>{const newElements=elements.filter(el=>el.id!==contextMenu.elementId);setElements(newElements);addToHistory(newElements);setSelectedId(null);// Transformerをクリア\nif(transformerRef.current){var _transformerRef$curre2;transformerRef.current.nodes([]);(_transformerRef$curre2=transformerRef.current.getLayer())===null||_transformerRef$curre2===void 0?void 0:_transformerRef$curre2.batchDraw();}setContextMenu(_objectSpread(_objectSpread({},contextMenu),{},{visible:false}));},children:\"\\uD83D\\uDDD1\\uFE0F\"})]})]});};export default BusinessCardDesign;","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","useAuth","Stage","Layer","Rect","Text","Transformer","Circle","Line","Group","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","BusinessCardDesign","user","isAuthenticated","navigate","profile","setProfile","isLoading","setIsLoading","currentSide","setCurrentSide","elements","setElements","selectedId","setSelectedId","editingText","setEditingText","fontSize","setFontSize","textColor","setTextColor","fontFamily","setFontFamily","currentTool","setCurrentTool","showGrid","setShowGrid","showGuidelines","setShowGuidelines","history","setHistory","historyIndex","setHistoryIndex","showTextModal","setShowTextModal","selectedTextStyle","setSelectedTextStyle","contextMenu","setContextMenu","visible","x","y","elementId","transformerRef","stageRef","mockProfile","id","userId","company","jobTitle","bio","skills","interests","contactInfo","email","phone","sns","twitter","linkedin","github","instagram","website","isPublic","createdAt","Date","updatedAt","initialElements","type","text","fill","width","align","draggable","textStyle","name","addToHistory","current","_stageRef$current","node","findOne","concat","_transformerRef$curre","nodes","getLayer","batchDraw","newElements","newHistory","slice","push","length","undo","newIndex","redo","moveElement","direction","currentIndex","findIndex","el","alignElements","alignment","selectedElement","find","map","newEl","_objectSpread","handleTextClick","event","stage","target","getStage","pointerPosition","getPointerPosition","canvasWrapper","document","querySelector","rect","getBoundingClientRect","left","top","handleTextEdit","newText","handleElementUpdate","updates","handleAddText","style","arguments","undefined","now","handleAddShape","shapeType","newShape","height","stroke","strokeWidth","radius","points","handleAddIcon","iconType","newIcon","size","handleDeleteElement","filter","handleSave","Promise","resolve","setTimeout","console","log","error","handleCancel","handleExportImage","dataURL","toDataURL","link","createElement","download","href","click","renderElement","element","onClick","e","onTap","onDragEnd","children","className","ref","onMouseDown","Array","from","_","i","dash","stopPropagation","placeholder","value","onChange","onBlur","onKeyPress","key","min","max","Number","position","zIndex","_transformerRef$curre2"],"sources":["/Users/takahiro/Dev/webhack/src/pages/BusinessCardDesign.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useAuth } from \"../contexts/AuthContext\";\nimport { Profile } from \"../types\";\nimport {\n  Stage,\n  Layer,\n  Rect,\n  Text,\n  Transformer,\n  Circle,\n  Line,\n  Group,\n} from \"react-konva\";\nimport Konva from \"konva\";\nimport \"./BusinessCardDesign.css\";\n\ninterface TextElement {\n  id: string;\n  type: \"text\";\n  text: string;\n  x: number;\n  y: number;\n  fontSize: number;\n  fontFamily: string;\n  fill: string;\n  width: number;\n  align: string;\n  draggable: boolean;\n  textStyle?: \"heading\" | \"subheading\" | \"body\";\n}\n\ninterface ShapeElement {\n  id: string;\n  type: \"rect\" | \"circle\" | \"line\";\n  x: number;\n  y: number;\n  width?: number;\n  height?: number;\n  radius?: number;\n  points?: number[];\n  fill: string;\n  stroke: string;\n  strokeWidth: number;\n  draggable: boolean;\n}\n\ninterface IconElement {\n  id: string;\n  type: \"icon\";\n  iconType: string;\n  x: number;\n  y: number;\n  size: number;\n  fill: string;\n  draggable: boolean;\n}\n\ntype DesignElement = TextElement | ShapeElement | IconElement;\n\nconst BusinessCardDesign: React.FC = () => {\n  const { user, isAuthenticated } = useAuth();\n  const navigate = useNavigate();\n  const [profile, setProfile] = useState<Profile | null>(null);\n  const [isLoading, setIsLoading] = useState(true);\n  const [currentSide, setCurrentSide] = useState<\"front\" | \"back\">(\"front\");\n  const [elements, setElements] = useState<DesignElement[]>([]);\n  const [selectedId, setSelectedId] = useState<string | null>(null);\n  const [editingText, setEditingText] = useState<string>(\"\");\n  const [fontSize, setFontSize] = useState(16);\n  const [textColor, setTextColor] = useState(\"#000000\");\n  const [fontFamily, setFontFamily] = useState(\"Arial\");\n  const [currentTool, setCurrentTool] = useState<\n    \"select\" | \"text\" | \"rect\" | \"circle\" | \"line\" | \"icon\"\n  >(\"select\");\n  const [showGrid, setShowGrid] = useState(false);\n  const [showGuidelines, setShowGuidelines] = useState(true);\n  const [history, setHistory] = useState<DesignElement[][]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [showTextModal, setShowTextModal] = useState(false);\n  const [selectedTextStyle, setSelectedTextStyle] = useState<\n    \"heading\" | \"subheading\" | \"body\"\n  >(\"body\");\n  const [contextMenu, setContextMenu] = useState<{\n    visible: boolean;\n    x: number;\n    y: number;\n    elementId: string;\n  }>({\n    visible: false,\n    x: 0,\n    y: 0,\n    elementId: \"\",\n  });\n\n  const transformerRef = useRef<Konva.Transformer>(null);\n  const stageRef = useRef<Konva.Stage>(null);\n\n  useEffect(() => {\n    if (!isAuthenticated) {\n      navigate(\"/login\");\n      return;\n    }\n\n    // モックプロフィールデータを取得\n    const mockProfile: Profile = {\n      id: \"1\",\n      userId: user?.id || \"1\",\n      company: \"テック株式会社\",\n      jobTitle: \"フロントエンドエンジニア\",\n      bio: \"Web開発に携わって5年目です。React、TypeScript、Node.jsを中心に開発を行っています。ユーザビリティを重視した設計を心がけています。\",\n      skills: [\n        \"React\",\n        \"TypeScript\",\n        \"Node.js\",\n        \"CSS\",\n        \"HTML\",\n        \"JavaScript\",\n        \"Git\",\n        \"AWS\",\n      ],\n      interests: [\"プログラミング\", \"読書\", \"旅行\", \"料理\", \"音楽\"],\n      contactInfo: {\n        email: \"taro.tech@example.com\",\n        phone: \"090-1234-5678\",\n        sns: {\n          twitter: \"taro_tech\",\n          linkedin: \"taro-tech\",\n          github: \"taro-tech\",\n          instagram: \"taro_tech_dev\",\n        },\n        website: \"https://taro-tech.dev\",\n      },\n      isPublic: true,\n      createdAt: new Date(\"2024-01-01\"),\n      updatedAt: new Date(),\n    };\n\n    setProfile(mockProfile);\n    setIsLoading(false);\n  }, [isAuthenticated, user, navigate]);\n\n  // 初期テキスト要素を設定\n  useEffect(() => {\n    if (profile) {\n      const initialElements: DesignElement[] =\n        currentSide === \"front\"\n          ? [\n              {\n                id: \"company\",\n                type: \"text\",\n                text: profile.company || \"会社名\",\n                x: 200,\n                y: 60,\n                fontSize: 18,\n                fontFamily: \"Arial\",\n                fill: \"#000000\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"heading\",\n              },\n              {\n                id: \"jobTitle\",\n                type: \"text\",\n                text: profile.jobTitle || \"役職\",\n                x: 200,\n                y: 90,\n                fontSize: 14,\n                fontFamily: \"Arial\",\n                fill: \"#666666\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"subheading\",\n              },\n              {\n                id: \"name\",\n                type: \"text\",\n                text: user?.name || \"氏名\",\n                x: 200,\n                y: 120,\n                fontSize: 16,\n                fontFamily: \"Arial\",\n                fill: \"#000000\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"body\",\n              },\n            ]\n          : [\n              {\n                id: \"email\",\n                type: \"text\",\n                text: profile.contactInfo.email || \"メールアドレス\",\n                x: 200,\n                y: 80,\n                fontSize: 12,\n                fontFamily: \"Arial\",\n                fill: \"#000000\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"body\",\n              },\n              {\n                id: \"phone\",\n                type: \"text\",\n                text: profile.contactInfo.phone || \"電話番号\",\n                x: 200,\n                y: 110,\n                fontSize: 12,\n                fontFamily: \"Arial\",\n                fill: \"#000000\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"body\",\n              },\n              {\n                id: \"website\",\n                type: \"text\",\n                text: profile.contactInfo.website || \"ウェブサイト\",\n                x: 200,\n                y: 140,\n                fontSize: 12,\n                fontFamily: \"Arial\",\n                fill: \"#000000\",\n                width: 400,\n                align: \"center\",\n                draggable: true,\n                textStyle: \"body\",\n              },\n            ];\n\n      setElements(initialElements);\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      addToHistory(initialElements);\n    }\n  }, [profile, currentSide, user]);\n\n  // 選択された要素のTransformerを更新\n  useEffect(() => {\n    if (selectedId && transformerRef.current) {\n      const node = stageRef.current?.findOne(`#${selectedId}`);\n      if (node) {\n        transformerRef.current.nodes([node]);\n        transformerRef.current.getLayer()?.batchDraw();\n      }\n    }\n  }, [selectedId]);\n\n  // 履歴管理\n  const addToHistory = (newElements: DesignElement[]) => {\n    const newHistory = history.slice(0, historyIndex + 1);\n    newHistory.push([...newElements]);\n    setHistory(newHistory);\n    setHistoryIndex(newHistory.length - 1);\n  };\n\n  const undo = () => {\n    if (historyIndex > 0) {\n      const newIndex = historyIndex - 1;\n      setHistoryIndex(newIndex);\n      setElements([...history[newIndex]]);\n    }\n  };\n\n  const redo = () => {\n    if (historyIndex < history.length - 1) {\n      const newIndex = historyIndex + 1;\n      setHistoryIndex(newIndex);\n      setElements([...history[newIndex]]);\n    }\n  };\n\n  const moveElement = (id: string, direction: \"forward\" | \"backward\") => {\n    const newElements = [...elements];\n    const currentIndex = newElements.findIndex((el) => el.id === id);\n\n    if (direction === \"forward\" && currentIndex < newElements.length - 1) {\n      [newElements[currentIndex], newElements[currentIndex + 1]] = [\n        newElements[currentIndex + 1],\n        newElements[currentIndex],\n      ];\n    } else if (direction === \"backward\" && currentIndex > 0) {\n      [newElements[currentIndex], newElements[currentIndex - 1]] = [\n        newElements[currentIndex - 1],\n        newElements[currentIndex],\n      ];\n    }\n\n    setElements(newElements);\n    addToHistory(newElements);\n  };\n\n  const alignElements = (\n    alignment: \"left\" | \"center\" | \"right\" | \"top\" | \"middle\" | \"bottom\"\n  ) => {\n    if (selectedId) {\n      const selectedElement = elements.find((el) => el.id === selectedId);\n      if (!selectedElement) return;\n\n      const newElements = elements.map((el) => {\n        if (el.id === selectedId) {\n          const newEl = { ...el };\n          switch (alignment) {\n            case \"left\":\n              newEl.x = 50;\n              break;\n            case \"center\":\n              newEl.x = 200;\n              break;\n            case \"right\":\n              newEl.x = 350;\n              break;\n            case \"top\":\n              newEl.y = 50;\n              break;\n            case \"middle\":\n              newEl.y = 121;\n              break;\n            case \"bottom\":\n              newEl.y = 192;\n              break;\n          }\n          return newEl;\n        }\n        return el;\n      });\n\n      setElements(newElements);\n      addToHistory(newElements);\n    }\n  };\n\n  const handleTextClick = (id: string, event: any) => {\n    setSelectedId(id);\n\n    // コンテキストメニューの位置を計算\n    const stage = event.target.getStage();\n    const pointerPosition = stage.getPointerPosition();\n\n    // Konvaステージの左上にコンテキストメニューを配置\n    // canvas-wrapperの位置を考慮して座標を計算\n    const canvasWrapper = document.querySelector(\".canvas-wrapper\");\n    if (canvasWrapper) {\n      const rect = canvasWrapper.getBoundingClientRect();\n      setContextMenu({\n        visible: true,\n        x: rect.left + 10, // canvas-wrapperの左上から10px右\n        y: rect.top + 10, // canvas-wrapperの左上から10px下\n        elementId: id,\n      });\n    } else {\n      // フォールバック: 固定位置\n      setContextMenu({\n        visible: true,\n        x: 10,\n        y: 10,\n        elementId: id,\n      });\n    }\n  };\n\n  const handleTextEdit = (id: string, newText: string) => {\n    const newElements = elements.map((el) =>\n      el.id === id && el.type === \"text\" ? { ...el, text: newText } : el\n    );\n    setElements(newElements);\n    addToHistory(newElements);\n    setEditingText(\"\");\n  };\n\n  const handleElementUpdate = (id: string, updates: any) => {\n    const newElements = elements.map((el) =>\n      el.id === id ? { ...el, ...updates } : el\n    );\n    setElements(newElements);\n    addToHistory(newElements);\n  };\n\n  const handleAddText = (style: \"heading\" | \"subheading\" | \"body\" = \"body\") => {\n    let fontSize = 16;\n    let y = 100;\n\n    switch (style) {\n      case \"heading\":\n        fontSize = 24;\n        y = 80;\n        break;\n      case \"subheading\":\n        fontSize = 18;\n        y = 110;\n        break;\n      case \"body\":\n        fontSize = 14;\n        y = 140;\n        break;\n    }\n\n    const newText: TextElement = {\n      id: `text-${Date.now()}`,\n      type: \"text\",\n      text:\n        style === \"heading\"\n          ? \"見出し\"\n          : style === \"subheading\"\n          ? \"小見出し\"\n          : \"本文\",\n      x: 200,\n      y: y,\n      fontSize: fontSize,\n      fontFamily: fontFamily,\n      fill: textColor,\n      width: 400,\n      align: \"center\",\n      draggable: true,\n      textStyle: style,\n    };\n    const newElements = [...elements, newText];\n    setElements(newElements);\n    addToHistory(newElements);\n    setSelectedId(newText.id);\n    setShowTextModal(true);\n  };\n\n  const handleAddShape = (shapeType: \"rect\" | \"circle\" | \"line\") => {\n    let newShape: ShapeElement;\n\n    switch (shapeType) {\n      case \"rect\":\n        newShape = {\n          id: `rect-${Date.now()}`,\n          type: \"rect\",\n          x: 100,\n          y: 100,\n          width: 100,\n          height: 60,\n          fill: textColor,\n          stroke: \"#000000\",\n          strokeWidth: 2,\n          draggable: true,\n        };\n        break;\n      case \"circle\":\n        newShape = {\n          id: `circle-${Date.now()}`,\n          type: \"circle\",\n          x: 150,\n          y: 150,\n          radius: 30,\n          fill: textColor,\n          stroke: \"#000000\",\n          strokeWidth: 2,\n          draggable: true,\n        };\n        break;\n      case \"line\":\n        newShape = {\n          id: `line-${Date.now()}`,\n          type: \"line\",\n          x: 100,\n          y: 100,\n          points: [0, 0, 100, 0],\n          fill: \"#000000\",\n          stroke: \"#000000\",\n          strokeWidth: 2,\n          draggable: true,\n        };\n        break;\n    }\n\n    const newElements = [...elements, newShape];\n    setElements(newElements);\n    addToHistory(newElements);\n    setSelectedId(newShape.id);\n  };\n\n  const handleAddIcon = (iconType: string) => {\n    const newIcon: IconElement = {\n      id: `icon-${Date.now()}`,\n      type: \"icon\",\n      iconType,\n      x: 100,\n      y: 100,\n      size: 24,\n      fill: textColor,\n      draggable: true,\n    };\n\n    const newElements = [...elements, newIcon];\n    setElements(newElements);\n    addToHistory(newElements);\n    setSelectedId(newIcon.id);\n  };\n\n  const handleDeleteElement = () => {\n    if (selectedId) {\n      const newElements = elements.filter((el) => el.id !== selectedId);\n      setElements(newElements);\n      addToHistory(newElements);\n      setSelectedId(null);\n    }\n  };\n\n  const handleSave = async () => {\n    try {\n      await new Promise((resolve) => setTimeout(resolve, 1000));\n      console.log(\"名刺デザインを保存しました\");\n      console.log(\"現在の要素:\", elements);\n      navigate(\"/business-card/edit\");\n    } catch (error) {\n      console.error(\"名刺デザインの保存に失敗しました:\", error);\n    }\n  };\n\n  const handleCancel = () => {\n    navigate(\"/business-card/edit\");\n  };\n\n  const handleExportImage = () => {\n    if (stageRef.current) {\n      const dataURL = stageRef.current.toDataURL();\n      const link = document.createElement(\"a\");\n      link.download = `business-card-${currentSide}.png`;\n      link.href = dataURL;\n      link.click();\n    }\n  };\n\n  const renderElement = (element: DesignElement) => {\n    switch (element.type) {\n      case \"text\":\n        return (\n          <Text\n            key={element.id}\n            id={element.id}\n            text={element.text}\n            x={element.x}\n            y={element.y}\n            fontSize={element.fontSize}\n            fontFamily={element.fontFamily}\n            fill={element.fill}\n            align={element.align as any}\n            width={element.width}\n            draggable={element.draggable}\n            onClick={(e) => handleTextClick(element.id, e)}\n            onTap={(e) => handleTextClick(element.id, e)}\n            onDragEnd={(e) => {\n              handleElementUpdate(element.id, {\n                x: e.target.x(),\n                y: e.target.y(),\n              });\n            }}\n          />\n        );\n      case \"rect\":\n        return (\n          <Rect\n            key={element.id}\n            id={element.id}\n            x={element.x}\n            y={element.y}\n            width={element.width}\n            height={element.height}\n            fill={element.fill}\n            stroke={element.stroke}\n            strokeWidth={element.strokeWidth}\n            draggable={element.draggable}\n            onClick={() => setSelectedId(element.id)}\n            onTap={() => setSelectedId(element.id)}\n            onDragEnd={(e) => {\n              handleElementUpdate(element.id, {\n                x: e.target.x(),\n                y: e.target.y(),\n              });\n            }}\n          />\n        );\n      case \"circle\":\n        return (\n          <Circle\n            key={element.id}\n            id={element.id}\n            x={element.x}\n            y={element.y}\n            radius={element.radius}\n            fill={element.fill}\n            stroke={element.stroke}\n            strokeWidth={element.strokeWidth}\n            draggable={element.draggable}\n            onClick={() => setSelectedId(element.id)}\n            onTap={() => setSelectedId(element.id)}\n            onDragEnd={(e) => {\n              handleElementUpdate(element.id, {\n                x: e.target.x(),\n                y: e.target.y(),\n              });\n            }}\n          />\n        );\n      case \"line\":\n        return (\n          <Line\n            key={element.id}\n            id={element.id}\n            x={element.x}\n            y={element.y}\n            points={element.points}\n            fill={element.fill}\n            stroke={element.stroke}\n            strokeWidth={element.strokeWidth}\n            draggable={element.draggable}\n            onClick={() => setSelectedId(element.id)}\n            onTap={() => setSelectedId(element.id)}\n            onDragEnd={(e) => {\n              handleElementUpdate(element.id, {\n                x: e.target.x(),\n                y: e.target.y(),\n              });\n            }}\n          />\n        );\n      case \"icon\":\n        return (\n          <Group\n            key={element.id}\n            id={element.id}\n            x={element.x}\n            y={element.y}\n            draggable={element.draggable}\n            onClick={() => setSelectedId(element.id)}\n            onTap={() => setSelectedId(element.id)}\n            onDragEnd={(e) => {\n              handleElementUpdate(element.id, {\n                x: e.target.x(),\n                y: e.target.y(),\n              });\n            }}\n          >\n            {element.iconType === \"phone\" && (\n              <Rect\n                x={0}\n                y={0}\n                width={element.size}\n                height={element.size * 1.6}\n                fill={element.fill}\n              />\n            )}\n            {element.iconType === \"email\" && (\n              <Rect\n                x={0}\n                y={0}\n                width={element.size}\n                height={element.size * 0.8}\n                fill={element.fill}\n              />\n            )}\n            {element.iconType === \"website\" && (\n              <Circle\n                x={element.size / 2}\n                y={element.size / 2}\n                radius={element.size / 2}\n                fill={element.fill}\n              />\n            )}\n          </Group>\n        );\n      default:\n        return null;\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"business-card-design\">\n        <div className=\"container\">\n          <div className=\"loading\">読み込み中...</div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!profile) {\n    return (\n      <div className=\"business-card-design\">\n        <div className=\"container\">\n          <div className=\"error\">プロフィールが見つかりません</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"business-card-design\">\n      <div className=\"container\">\n        <div className=\"design-header\">\n          <h1>名刺デザイン</h1>\n          <p>名刺の表面・裏面をデザインできます</p>\n        </div>\n\n        <div className=\"design-container\">\n          {/* サイド選択タブ */}\n          <div className=\"side-tabs\">\n            <button\n              className={`side-tab ${currentSide === \"front\" ? \"active\" : \"\"}`}\n              onClick={() => setCurrentSide(\"front\")}\n            >\n              表面\n            </button>\n            <button\n              className={`side-tab ${currentSide === \"back\" ? \"active\" : \"\"}`}\n              onClick={() => setCurrentSide(\"back\")}\n            >\n              裏面\n            </button>\n          </div>\n\n          {/* 描画エリア */}\n          <div className=\"canvas-container\">\n            <div className=\"canvas-wrapper\">\n              <Stage\n                ref={stageRef}\n                width={400}\n                height={242}\n                onMouseDown={(e) => {\n                  if (e.target === e.target.getStage()) {\n                    setSelectedId(null);\n                    setContextMenu({ ...contextMenu, visible: false });\n                  }\n                }}\n              >\n                <Layer>\n                  {/* 背景 */}\n                  <Rect\n                    x={0}\n                    y={0}\n                    width={400}\n                    height={242}\n                    fill=\"#ffffff\"\n                    stroke=\"#e5e7eb\"\n                    strokeWidth={1}\n                  />\n\n                  {/* グリッド */}\n                  {showGrid && (\n                    <>\n                      {Array.from({ length: 20 }, (_, i) => (\n                        <Line\n                          key={`grid-v-${i}`}\n                          x={i * 20}\n                          y={0}\n                          points={[0, 0, 0, 242]}\n                          stroke=\"#f0f0f0\"\n                          strokeWidth={1}\n                        />\n                      ))}\n                      {Array.from({ length: 13 }, (_, i) => (\n                        <Line\n                          key={`grid-h-${i}`}\n                          x={0}\n                          y={i * 20}\n                          points={[0, 0, 400, 0]}\n                          stroke=\"#f0f0f0\"\n                          strokeWidth={1}\n                        />\n                      ))}\n                    </>\n                  )}\n\n                  {/* ガイドライン */}\n                  {showGuidelines && (\n                    <>\n                      <Line\n                        x={200}\n                        y={0}\n                        points={[0, 0, 0, 242]}\n                        stroke=\"#3b82f6\"\n                        strokeWidth={1}\n                        dash={[5, 5]}\n                      />\n                      <Line\n                        x={0}\n                        y={121}\n                        points={[0, 0, 400, 0]}\n                        stroke=\"#3b82f6\"\n                        strokeWidth={1}\n                        dash={[5, 5]}\n                      />\n                    </>\n                  )}\n\n                  {/* デザイン要素 */}\n                  {elements.map(renderElement)}\n\n                  {/* Transformer */}\n                  {selectedId && <Transformer ref={transformerRef} />}\n                </Layer>\n              </Stage>\n            </div>\n          </div>\n\n          {/* 下部ツールバー */}\n          <div className=\"bottom-toolbar\">\n            <div className=\"toolbar-scroll\">\n              <div\n                className=\"toolbar-item\"\n                onClick={() => setCurrentTool(\"select\")}\n              >\n                <div className=\"toolbar-icon\">✋</div>\n                <div className=\"toolbar-label\">選択</div>\n              </div>\n              <div\n                className=\"toolbar-item\"\n                onClick={() => handleAddText(\"heading\")}\n              >\n                <div className=\"toolbar-icon\">T</div>\n                <div className=\"toolbar-label\">テキスト</div>\n              </div>\n              <div\n                className=\"toolbar-item\"\n                onClick={() => handleAddShape(\"rect\")}\n              >\n                <div className=\"toolbar-icon\">□</div>\n                <div className=\"toolbar-label\">図形</div>\n              </div>\n              <div\n                className=\"toolbar-item\"\n                onClick={() => handleAddIcon(\"phone\")}\n              >\n                <div className=\"toolbar-icon\">📞</div>\n                <div className=\"toolbar-label\">アイコン</div>\n              </div>\n              <div\n                className={`toolbar-item ${\n                  historyIndex <= 0 ? \"disabled\" : \"\"\n                }`}\n                onClick={historyIndex > 0 ? undo : undefined}\n              >\n                <div className=\"toolbar-icon\">↶</div>\n                <div className=\"toolbar-label\">戻る</div>\n              </div>\n              <div\n                className={`toolbar-item ${\n                  historyIndex >= history.length - 1 ? \"disabled\" : \"\"\n                }`}\n                onClick={historyIndex < history.length - 1 ? redo : undefined}\n              >\n                <div className=\"toolbar-icon\">↷</div>\n                <div className=\"toolbar-label\">進む</div>\n              </div>\n            </div>\n          </div>\n\n          {/* アクションボタン */}\n          <div className=\"design-actions\">\n            <button\n              type=\"button\"\n              className=\"btn btn-secondary\"\n              onClick={handleCancel}\n            >\n              キャンセル\n            </button>\n            <button\n              type=\"button\"\n              className=\"btn btn-primary\"\n              onClick={handleSave}\n            >\n              デザインを保存\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* テキスト編集モーダル */}\n      {showTextModal && (\n        <div className=\"modal-overlay\" onClick={() => setShowTextModal(false)}>\n          <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"modal-header\">\n              <h3>テキスト編集</h3>\n              <button\n                className=\"modal-close\"\n                onClick={() => setShowTextModal(false)}\n              >\n                ×\n              </button>\n            </div>\n\n            <div className=\"modal-body\">\n              <div className=\"search-section\">\n                <div className=\"search-bar\">\n                  <span className=\"search-icon\">🔍</span>\n                  <input\n                    type=\"text\"\n                    placeholder=\"フォントと組み合わせを検索\"\n                    className=\"search-input\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"text-options\">\n                <button\n                  className=\"text-option-btn primary\"\n                  onClick={() => handleAddText(\"heading\")}\n                >\n                  <span className=\"text-icon\">T</span>\n                  <span className=\"text-label\">見出しを追加</span>\n                </button>\n\n                <button\n                  className=\"text-option-btn secondary\"\n                  onClick={() => handleAddText(\"subheading\")}\n                >\n                  <span className=\"text-icon\">T</span>\n                  <span className=\"text-label\">小見出しを追加</span>\n                </button>\n\n                <button\n                  className=\"text-option-btn secondary\"\n                  onClick={() => handleAddText(\"body\")}\n                >\n                  <span className=\"text-icon\">T</span>\n                  <span className=\"text-label\">本文を追加</span>\n                </button>\n              </div>\n\n              {selectedId && (\n                <div className=\"text-editor-section\">\n                  <h4>テキスト編集</h4>\n                  <input\n                    type=\"text\"\n                    value={editingText}\n                    onChange={(e) => setEditingText(e.target.value)}\n                    onBlur={() => handleTextEdit(selectedId, editingText)}\n                    onKeyPress={(e) => {\n                      if (e.key === \"Enter\") {\n                        handleTextEdit(selectedId, editingText);\n                      }\n                    }}\n                    placeholder=\"テキストを入力\"\n                    className=\"text-input\"\n                  />\n\n                  <div className=\"style-controls\">\n                    <label>\n                      フォントサイズ:\n                      <input\n                        type=\"range\"\n                        min=\"8\"\n                        max=\"48\"\n                        value={fontSize}\n                        onChange={(e) => {\n                          setFontSize(Number(e.target.value));\n                          if (selectedId) {\n                            const element = elements.find(\n                              (el) => el.id === selectedId\n                            );\n                            if (element && element.type === \"text\") {\n                              handleElementUpdate(selectedId, {\n                                fontSize: Number(e.target.value),\n                              });\n                            }\n                          }\n                        }}\n                        className=\"font-size-slider\"\n                      />\n                      <span>{fontSize}px</span>\n                    </label>\n\n                    <label>\n                      フォント:\n                      <select\n                        value={fontFamily}\n                        onChange={(e) => {\n                          setFontFamily(e.target.value);\n                          if (selectedId) {\n                            const element = elements.find(\n                              (el) => el.id === selectedId\n                            );\n                            if (element && element.type === \"text\") {\n                              handleElementUpdate(selectedId, {\n                                fontFamily: e.target.value,\n                              });\n                            }\n                          }\n                        }}\n                        className=\"font-family-select\"\n                      >\n                        <option value=\"Arial\">Arial</option>\n                        <option value=\"Helvetica\">Helvetica</option>\n                        <option value=\"Times New Roman\">Times New Roman</option>\n                        <option value=\"Georgia\">Georgia</option>\n                        <option value=\"Verdana\">Verdana</option>\n                      </select>\n                    </label>\n\n                    <label>\n                      色:\n                      <input\n                        type=\"color\"\n                        value={textColor}\n                        onChange={(e) => {\n                          setTextColor(e.target.value);\n                          if (selectedId) {\n                            handleElementUpdate(selectedId, {\n                              fill: e.target.value,\n                            });\n                          }\n                        }}\n                        className=\"color-picker\"\n                      />\n                    </label>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* コンテキストメニュー */}\n      {contextMenu.visible && (\n        <div\n          className=\"context-menu\"\n          style={{\n            position: \"absolute\",\n            left: contextMenu.x,\n            top: contextMenu.y,\n            zIndex: 1000,\n          }}\n        >\n          <button\n            className=\"context-menu-btn edit-btn\"\n            onClick={() => {\n              const element = elements.find(\n                (el) => el.id === contextMenu.elementId\n              );\n              if (element && element.type === \"text\") {\n                setEditingText(element.text);\n                setSelectedTextStyle(element.textStyle || \"body\");\n                setShowTextModal(true);\n              }\n              setContextMenu({ ...contextMenu, visible: false });\n            }}\n          >\n            ✏️\n          </button>\n          <button\n            className=\"context-menu-btn delete-btn\"\n            onClick={() => {\n              const newElements = elements.filter(\n                (el) => el.id !== contextMenu.elementId\n              );\n              setElements(newElements);\n              addToHistory(newElements);\n              setSelectedId(null);\n              // Transformerをクリア\n              if (transformerRef.current) {\n                transformerRef.current.nodes([]);\n                transformerRef.current.getLayer()?.batchDraw();\n              }\n              setContextMenu({ ...contextMenu, visible: false });\n            }}\n          >\n            🗑️\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default BusinessCardDesign;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}