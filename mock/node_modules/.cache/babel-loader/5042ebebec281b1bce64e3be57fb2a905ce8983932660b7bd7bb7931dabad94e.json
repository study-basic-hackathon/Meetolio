{"ast":null,"code":"/**\n * Based on ReactArt.js\n * Copyright (c) 2017-present Lavrenov Anton.\n * All rights reserved.\n *\n * MIT\n */\n'use strict';\n\nimport React from 'react';\nif (React.version.indexOf('19') === -1) {\n  throw new Error('react-konva version 19 is only compatible with React 19. Make sure to have the last version of react-konva and react or downgrade react-konva to version 18.');\n}\nimport Konva from 'konva/lib/Core.js';\nimport ReactFiberReconciler from 'react-reconciler';\nimport { ConcurrentRoot } from 'react-reconciler/constants.js';\nimport * as HostConfig from './ReactKonvaHostConfig.js';\nimport { applyNodeProps, toggleStrictMode } from './makeUpdates.js';\nimport { useContextBridge, FiberProvider } from 'its-fine';\nfunction usePrevious(value) {\n  const ref = React.useRef({});\n  React.useLayoutEffect(() => {\n    ref.current = value;\n  });\n  React.useLayoutEffect(() => {\n    return () => {\n      // when using suspense it is possible that stage is unmounted\n      // but React still keep component ref\n      // in that case we need to manually flush props\n      // we have a special test for that\n      ref.current = {};\n    };\n  }, []);\n  return ref.current;\n}\nconst useIsReactStrictMode = () => {\n  const memoCount = React.useRef(0);\n  // in strict mode, memo will be called twice\n  React.useMemo(() => {\n    memoCount.current++;\n  }, []);\n  return memoCount.current > 1;\n};\nconst StageWrap = props => {\n  const container = React.useRef(null);\n  const stage = React.useRef(null);\n  const fiberRef = React.useRef(null);\n  const oldProps = usePrevious(props);\n  const Bridge = useContextBridge();\n  const isMounted = React.useRef(false);\n  const _setRef = stage => {\n    const {\n      forwardedRef\n    } = props;\n    if (!forwardedRef) {\n      return;\n    }\n    if (typeof forwardedRef === 'function') {\n      forwardedRef(stage);\n    } else {\n      forwardedRef.current = stage;\n    }\n  };\n  const isStrictMode = useIsReactStrictMode();\n  React.useLayoutEffect(() => {\n    // is we are in strict mode, we need to ignore the second full render\n    // instead do nothing and just return clean function\n    if (isMounted.current && isStrictMode) {\n      return () => {\n        isMounted.current = false;\n        _setRef(null);\n        KonvaRenderer.updateContainer(null, fiberRef.current, null);\n        stage.current.destroy();\n      };\n    }\n    isMounted.current = true;\n    stage.current = new Konva.Stage({\n      width: props.width,\n      height: props.height,\n      container: container.current\n    });\n    _setRef(stage.current);\n    // @ts-ignore\n    fiberRef.current = KonvaRenderer.createContainer(stage.current, ConcurrentRoot, null, false, null, '', console.error, console.error, console.error, null);\n    KonvaRenderer.updateContainer(React.createElement(Bridge, {}, props.children), fiberRef.current, null, () => {});\n    return () => {\n      // inside React strict mode, we need to ignore cleanup, because it will mess with refs\n      if (isStrictMode) {\n        return;\n      }\n      _setRef(null);\n      KonvaRenderer.updateContainer(null, fiberRef.current, null);\n      stage.current.destroy();\n    };\n  }, []);\n  React.useLayoutEffect(() => {\n    _setRef(stage.current);\n    applyNodeProps(stage.current, props, oldProps);\n    KonvaRenderer.updateContainer(React.createElement(Bridge, {}, props.children), fiberRef.current, null);\n  });\n  return React.createElement('div', {\n    ref: container,\n    id: props.id,\n    accessKey: props.accessKey,\n    className: props.className,\n    role: props.role,\n    style: props.style,\n    tabIndex: props.tabIndex,\n    title: props.title\n  });\n};\nexport const Layer = 'Layer';\nexport const FastLayer = 'FastLayer';\nexport const Group = 'Group';\nexport const Label = 'Label';\nexport const Rect = 'Rect';\nexport const Circle = 'Circle';\nexport const Ellipse = 'Ellipse';\nexport const Wedge = 'Wedge';\nexport const Line = 'Line';\nexport const Sprite = 'Sprite';\nexport const Image = 'Image';\nexport const Text = 'Text';\nexport const TextPath = 'TextPath';\nexport const Star = 'Star';\nexport const Ring = 'Ring';\nexport const Arc = 'Arc';\nexport const Tag = 'Tag';\nexport const Path = 'Path';\nexport const RegularPolygon = 'RegularPolygon';\nexport const Arrow = 'Arrow';\nexport const Shape = 'Shape';\nexport const Transformer = 'Transformer';\nexport const version = '19.0.7';\n// @ts-ignore\nexport const KonvaRenderer = ReactFiberReconciler(HostConfig);\nKonvaRenderer.injectIntoDevTools({\n  // @ts-ignore\n  findHostInstanceByFiber: () => null,\n  bundleType: process.env.NODE_ENV !== 'production' ? 1 : 0,\n  version: React.version,\n  rendererPackageName: 'react-konva'\n});\n// Update Stage component declaration\nexport const Stage = React.forwardRef((props, ref) => {\n  return React.createElement(FiberProvider, {}, React.createElement(StageWrap, {\n    ...props,\n    forwardedRef: ref\n  }));\n});\nexport const useStrictMode = toggleStrictMode;","map":{"version":3,"names":["React","version","indexOf","Error","Konva","ReactFiberReconciler","ConcurrentRoot","HostConfig","applyNodeProps","toggleStrictMode","useContextBridge","FiberProvider","usePrevious","value","ref","useRef","useLayoutEffect","current","useIsReactStrictMode","memoCount","useMemo","StageWrap","props","container","stage","fiberRef","oldProps","Bridge","isMounted","_setRef","forwardedRef","isStrictMode","KonvaRenderer","updateContainer","destroy","Stage","width","height","createContainer","console","error","createElement","children","id","accessKey","className","role","style","tabIndex","title","Layer","FastLayer","Group","Label","Rect","Circle","Ellipse","Wedge","Line","Sprite","Image","Text","TextPath","Star","Ring","Arc","Tag","Path","RegularPolygon","Arrow","Shape","Transformer","injectIntoDevTools","findHostInstanceByFiber","bundleType","process","env","NODE_ENV","rendererPackageName","forwardRef","useStrictMode"],"sources":["/Users/takahiro/Dev/webhack/node_modules/react-konva/es/ReactKonvaCore.js"],"sourcesContent":["/**\n * Based on ReactArt.js\n * Copyright (c) 2017-present Lavrenov Anton.\n * All rights reserved.\n *\n * MIT\n */\n'use strict';\nimport React from 'react';\nif (React.version.indexOf('19') === -1) {\n    throw new Error('react-konva version 19 is only compatible with React 19. Make sure to have the last version of react-konva and react or downgrade react-konva to version 18.');\n}\nimport Konva from 'konva/lib/Core.js';\nimport ReactFiberReconciler from 'react-reconciler';\nimport { ConcurrentRoot } from 'react-reconciler/constants.js';\nimport * as HostConfig from './ReactKonvaHostConfig.js';\nimport { applyNodeProps, toggleStrictMode } from './makeUpdates.js';\nimport { useContextBridge, FiberProvider } from 'its-fine';\nfunction usePrevious(value) {\n    const ref = React.useRef({});\n    React.useLayoutEffect(() => {\n        ref.current = value;\n    });\n    React.useLayoutEffect(() => {\n        return () => {\n            // when using suspense it is possible that stage is unmounted\n            // but React still keep component ref\n            // in that case we need to manually flush props\n            // we have a special test for that\n            ref.current = {};\n        };\n    }, []);\n    return ref.current;\n}\nconst useIsReactStrictMode = () => {\n    const memoCount = React.useRef(0);\n    // in strict mode, memo will be called twice\n    React.useMemo(() => {\n        memoCount.current++;\n    }, []);\n    return memoCount.current > 1;\n};\nconst StageWrap = (props) => {\n    const container = React.useRef(null);\n    const stage = React.useRef(null);\n    const fiberRef = React.useRef(null);\n    const oldProps = usePrevious(props);\n    const Bridge = useContextBridge();\n    const isMounted = React.useRef(false);\n    const _setRef = (stage) => {\n        const { forwardedRef } = props;\n        if (!forwardedRef) {\n            return;\n        }\n        if (typeof forwardedRef === 'function') {\n            forwardedRef(stage);\n        }\n        else {\n            forwardedRef.current = stage;\n        }\n    };\n    const isStrictMode = useIsReactStrictMode();\n    React.useLayoutEffect(() => {\n        // is we are in strict mode, we need to ignore the second full render\n        // instead do nothing and just return clean function\n        if (isMounted.current && isStrictMode) {\n            return () => {\n                isMounted.current = false;\n                _setRef(null);\n                KonvaRenderer.updateContainer(null, fiberRef.current, null);\n                stage.current.destroy();\n            };\n        }\n        isMounted.current = true;\n        stage.current = new Konva.Stage({\n            width: props.width,\n            height: props.height,\n            container: container.current,\n        });\n        _setRef(stage.current);\n        // @ts-ignore\n        fiberRef.current = KonvaRenderer.createContainer(stage.current, ConcurrentRoot, null, false, null, '', console.error, console.error, console.error, null);\n        KonvaRenderer.updateContainer(React.createElement(Bridge, {}, props.children), fiberRef.current, null, () => { });\n        return () => {\n            // inside React strict mode, we need to ignore cleanup, because it will mess with refs\n            if (isStrictMode) {\n                return;\n            }\n            _setRef(null);\n            KonvaRenderer.updateContainer(null, fiberRef.current, null);\n            stage.current.destroy();\n        };\n    }, []);\n    React.useLayoutEffect(() => {\n        _setRef(stage.current);\n        applyNodeProps(stage.current, props, oldProps);\n        KonvaRenderer.updateContainer(React.createElement(Bridge, {}, props.children), fiberRef.current, null);\n    });\n    return React.createElement('div', {\n        ref: container,\n        id: props.id,\n        accessKey: props.accessKey,\n        className: props.className,\n        role: props.role,\n        style: props.style,\n        tabIndex: props.tabIndex,\n        title: props.title,\n    });\n};\nexport const Layer = 'Layer';\nexport const FastLayer = 'FastLayer';\nexport const Group = 'Group';\nexport const Label = 'Label';\nexport const Rect = 'Rect';\nexport const Circle = 'Circle';\nexport const Ellipse = 'Ellipse';\nexport const Wedge = 'Wedge';\nexport const Line = 'Line';\nexport const Sprite = 'Sprite';\nexport const Image = 'Image';\nexport const Text = 'Text';\nexport const TextPath = 'TextPath';\nexport const Star = 'Star';\nexport const Ring = 'Ring';\nexport const Arc = 'Arc';\nexport const Tag = 'Tag';\nexport const Path = 'Path';\nexport const RegularPolygon = 'RegularPolygon';\nexport const Arrow = 'Arrow';\nexport const Shape = 'Shape';\nexport const Transformer = 'Transformer';\nexport const version = '19.0.7';\n// @ts-ignore\nexport const KonvaRenderer = ReactFiberReconciler(HostConfig);\nKonvaRenderer.injectIntoDevTools({\n    // @ts-ignore\n    findHostInstanceByFiber: () => null,\n    bundleType: process.env.NODE_ENV !== 'production' ? 1 : 0,\n    version: React.version,\n    rendererPackageName: 'react-konva',\n});\n// Update Stage component declaration\nexport const Stage = React.forwardRef((props, ref) => {\n    return React.createElement(FiberProvider, {}, React.createElement(StageWrap, { ...props, forwardedRef: ref }));\n});\nexport const useStrictMode = toggleStrictMode;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}