<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ポートフォリオテーブルMapper -->
<mapper namespace="com.meetolio.backend.repository.PortfolioRepository">

    <!-- ポートフォリオID検索 -->
    <select id="findById">
        SELECT user_id, name, name_kana, company, occupation, description, name_card_img_url, email, twitter, linkedin, github, website, created_at, updated_at
        FROM portfolios
        WHERE user_id = #{userId}
    </select>

    <!-- ポートフォリオ作成・更新（UPSERT） -->
    <insert id="save">
        INSERT INTO portfolios (user_id, name, name_kana, company, occupation, description, name_card_img_url, email, twitter, linkedin, github, website)
        VALUES (#{userId}, #{name}, #{nameKana}, #{company}, #{occupation}, #{description}, #{nameCardImgUrl}, #{email}, #{twitter}, #{linkedin}, #{github}, #{website})
        ON CONFLICT (user_id)
        DO UPDATE SET
            name = EXCLUDED.name,
            name_kana = EXCLUDED.name_kana,
            company = EXCLUDED.company,
            occupation = EXCLUDED.occupation,
            description = EXCLUDED.description,
            name_card_img_url = EXCLUDED.name_card_img_url,
            email = EXCLUDED.email,
            twitter = EXCLUDED.twitter,
            linkedin = EXCLUDED.linkedin,
            github = EXCLUDED.github,
            website = EXCLUDED.website,
            updated_at = NOW()
    </insert>

    <!-- ユーザーIDでポートフォリオ削除 -->
    <delete id="deleteByUserId">
        DELETE FROM portfolios
        WHERE user_id = #{userId}
    </delete>
</mapper>